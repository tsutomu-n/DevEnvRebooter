# DevEnvRebooter 開発者ガイド

## 目次
- [DevEnvRebooter 開発者ガイド](#devenvrebooter-開発者ガイド)
  - [目次](#目次)
  - [はじめに](#はじめに)
  - [開発環境のセットアップ](#開発環境のセットアップ)
  - [プロジェクト構造](#プロジェクト構造)
  - [主要モジュールの概要](#主要モジュールの概要)
  - [コーディング規約](#コーディング規約)
  - [テスト](#テスト)
  - [ビルドとデプロイメント](#ビルドとデプロイメント)
  - [貢献ガイドライン](#貢献ガイドライン)
  - [トラブルシューティングと開発のヒント](#トラブルシューティングと開発のヒント)

## はじめに

このガイドは、DevEnvRebooterの開発に参加する開発者向けの包括的な情報を提供します。プロジェクトの構造、主要なコンポーネント、開発プロセスについて詳しく説明します。

## 開発環境のセットアップ

1. **必要なツール**:
   - Visual Studio Code（推奨）またはPowerShell ISE
   - PowerShell 5.1以降
   - Git
   - Pester（PowerShellテストフレームワーク）

2. **環境構築手順**:
   ```powershell
   # リポジトリのクローン
   git clone https://github.com/yourusername/DevEnvRebooter.git
   cd DevEnvRebooter

   # 必要なモジュールのインストール
   Install-Module -Name Pester -Scope CurrentUser -Force

   # 開発用設定ファイルの作成
   Copy-Item config.json dev_config.json
   ```

3. **Visual Studio Code 拡張機能**:
   - PowerShell（ms-vscode.powershell）
   - PSScriptAnalyzer（ms-vscode.powershell-preview）

## プロジェクト構造

```
DevEnvRebooter/
│
├── main.ps1                # メインスクリプト
├── config.json             # 設定ファイル
│
├── modules/                # 機能別モジュール
│   ├── AdminCheck.psm1
│   ├── WslFunctions.psm1
│   ├── BrowserFunctions.psm1
│   ├── IdeFunctions.psm1
│   ├── Logging.psm1
│   ├── GUI.psm1
│   ├── Notification.psm1
│   ├── CommonFunctions.psm1
│   ├── ProcessManagement.psm1
│   ├── Scheduling.psm1
│   └── SecurityFunctions.psm1
│
├── Tests/                  # テストディレクトリ
│   ├── UnitTests.ps1
│   └── IntegrationTests.ps1
│
├── logs/                   # ログ出力ディレクトリ
│   └── restart_log.txt
│
├── docs/                   # ドキュメント
│   ├── UserGuide.md
│   └── DeveloperGuide.md
│
└── README.md
```

## 主要モジュールの概要

- **AdminCheck.psm1**: 管理者権限の確認と要求を行います。
- **WslFunctions.psm1**: WSLの再起動機能を提供します。
- **BrowserFunctions.psm1**: ブラウザの再起動を管理します。
- **IdeFunctions.psm1**: IDEの再起動を管理します。
- **Logging.psm1**: ログ記録とログローテーション機能を提供します。
- **GUI.psm1**: グラフィカルユーザーインターフェース要素を管理します。
- **Notification.psm1**: ユーザー通知機能を提供します。
- **ProcessManagement.psm1**: プロセスの検出と管理を行います。
- **Scheduling.psm1**: タスクスケジューリング機能を提供します。
- **SecurityFunctions.psm1**: 設定ファイルの暗号化や認証機能を提供します。

## コーディング規約

1. **命名規則**:
   - 関数名: Pascal Case（例: `Get-ProcessInfo`）
   - 変数名: Camel Case（例: `$localVariable`）
   - 定数: 大文字とアンダースコア（例: `$GLOBAL_CONSTANT`）

2. **コメント**:
   - 各関数の前に詳細なコメントブロックを記述
   - 複雑なロジックには行コメントを追加

3. **エラーハンドリング**:
   - try-catch ブロックを使用して例外を適切に処理
   - エラーメッセージは具体的かつ有用であること

4. **モジュール構造**:
   - 各モジュールは単一の責任を持つこと
   - 関連する機能をグループ化し、適切に分離すること

5. **セキュリティ**:
   - ユーザー入力は必ず検証とサニタイズを行うこと
   - 機密情報（パスワードなど）はプレーンテキストで保存しないこと

## テスト

テストは `Tests` ディレクトリ内の `UnitTests.ps1` と `IntegrationTests.ps1` で管理されています。

テストの実行:
```powershell
Invoke-Pester .\Tests\UnitTests.ps1
Invoke-Pester .\Tests\IntegrationTests.ps1
```

新機能やバグ修正を実装する際は、必ず対応するテストを追加または更新してください。

## ビルドとデプロイメント

現在、DevEnvRebooterは単一のPowerShellスクリプトとして動作するため、従来の意味でのビルドプロセスはありません。ただし、以下の手順を実行して、配布用パッケージを作成できます：

1. すべてのテストが通過することを確認
2. ドキュメント（README.md, UserGuide.md, DeveloperGuide.md）を最新の状態に更新
3. `config.json` のサンプルファイルを作成（機密情報を除去）
4. 必要なファイルのみをまとめたZIPアーカイブを作成

## 貢献ガイドライン

1. 新機能やバグ修正は、必ず新しいブランチで作業してください。
2. コミットメッセージは明確で説明的であること。
3. プルリクエストを作成する前に、すべてのテストが通過することを確認。
4. プルリクエストには、変更内容の詳細な説明を含めてください。
5. コードレビューのコメントには迅速に対応してください。

## トラブルシューティングと開発のヒント

1. **デバッグ**:
   - Visual Studio CodeのPowerShellデバッガを使用して、ブレークポイントを設定し、変数の状態を確認できます。
   - `Write-Debug` を使用して、デバッグ情報を出力します。

2. **パフォーマンス最適化**:
   - 大きなループ内での頻繁な関数呼び出しを避けます。
   - Where-Objectの代わりに、可能な限りフィルタリング構文を使用します。
   - 大量のデータを処理する場合は、パイプラインの使用を検討してください。

3. **モジュール開発**:
   - 新しいモジュールを追加する場合は、既存のモジュールとの依存関係を最小限に抑えてください。
   - モジュール間の循環依存を避けてください。

4. **セキュリティ考慮事項**:
   - ユーザー入力は常にサニタイズし、潜在的な悪意のある入力を防ぎます。
   - 機密情報（パスワードなど）は必ず暗号化して保存してください。
   - 外部コマンドを実行する際は、入力を適切にエスケープしてください。

5. **エラーハンドリング**:
   - 特定のエラーに対しては、カスタム例外タイプを定義して使用することを検討してください。
   - グローバルなエラーハンドラーを実装し、未処理の例外をキャッチして適切にログに記録してください。

6. **ログ記録のベストプラクティス**:
   - ログレベル（INFO, WARNING, ERROR）を適切に使用してください。
   - パフォーマンスに影響を与える可能性があるため、デバッグ目的以外では過剰なログ出力を避けてください。

7. **設定管理**:
   - 環境固有の設定は、config.jsonファイルに集中させてください。
   - 開発環境と本番環境で異なる設定を使用する場合は、環境変数を利用して切り替えることを検討してください。

8. **バージョン管理**:
   - セマンティックバージョニング（SemVer）を使用してバージョンを管理してください。
   - 各リリースには、CHANGELOG.mdファイルで変更内容を詳細に記録してください。

9. **ドキュメンテーション**:
   - コードの複雑な部分には、詳細なコメントを追加してください。
   - 公開API関数には、必ずヘルプコメントを追加してください。
   - README.md, UserGuide.md, DeveloperGuide.mdは常に最新の状態を保ってください。

10. **継続的インテグレーション（CI）**:
    - GitHubActionsを使用して、プルリクエスト時に自動的にテストを実行するCI環境を構築することを検討してください。
    - CIプロセスには、コードスタイルチェック（PSScriptAnalyzer）も含めてください。

11. **コード品質**:
    - 定期的にコードレビューを実施し、ベストプラクティスに従っているか確認してください。
    - 技術的負債を管理し、定期的にリファクタリングを行ってください。

12. **パフォーマンスプロファイリング**:
    - `Measure-Command` を使用して、パフォーマンスのボトルネックを特定してください。
    - 大規模な環境でのテストを定期的に実施し、スケーラビリティの問題を早期に発見してください。

13. **国際化（i18n）とローカライゼーション（l10n）**:
    - 将来的な多言語サポートを考慮し、ユーザーに表示されるメッセージはすべて外部化することを検討してください。
    - メッセージカタログを使用して、言語リソースを管理してください。

14. **コミュニティとの連携**:
    - 積極的にIssueに対応し、コミュニティからのフィードバックを取り入れてください。
    - 定期的にコミュニティの貢献者に感謝を表明し、オープンソースプロジェクトの健全性を維持してください。

15. **将来の拡張性**:
    - 新機能の追加が容易になるよう、モジュラーな設計を心がけてください。
    - 将来的なクロスプラットフォーム対応の可能性を考慮し、Windows固有の機能への依存を最小限に抑えてください。

以上の指針に従うことで、DevEnvRebooterプロジェクトの品質、保守性、拡張性を維持・向上させることができます。開発者の皆様のご協力に感謝いたします。プロジェクトに関する質問や提案がありましたら、いつでもお気軽にIssueを作成してください。

Happy coding!